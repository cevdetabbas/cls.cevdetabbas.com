<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>v2 gen5 | v70</title>
  <style>
    :root {
      --bg: #f5f5f7;
      --card: rgba(255, 255, 255, 0.95);
      --text: #1d1d1f;
      --muted: #86868b;
      --blue: #0071e3;
      --rainbow: linear-gradient(120deg, #ff3b30, #ff9500, #ffcc00, #34c759, #007aff, #5856d6, #ff2d55);
      --card-glass: rgba(255, 255, 255, 0.8);
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
      background: var(--bg); color: var(--text);
      display: flex; flex-direction: column; height: 100vh; overflow: hidden;
      transition: background-color 2s ease;
    }

    /* HEADER */
    header {
      background: rgba(255, 255, 255, 0.8); padding: 15px 40px; 
      display: grid; grid-template-columns: 220px 1fr 220px; align-items: center;
      border-bottom: 1px solid #e5e5e5; z-index: 100;
      backdrop-filter: blur(20px);
    }
    .head-label { font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase; margin-right: 5px; }
    .head-val { font-variant-numeric: tabular-nums; font-weight: 700; font-size: 18px; }
    h1 { text-align: center; margin: 0; font-size: 24px; font-weight: 950; letter-spacing: -1px; }

    /* FLIGHT DECK (STANDBY BAR) */
    #flight-deck {
      background: #000; color: #fff; height: 0; overflow: hidden;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 90;
    }
    #flight-deck.active { height: 100px; }
    .deck-lbl { font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 1px; }
    .slot-timer { font-family: 'Courier New', Courier, monospace; font-size: 40px; font-weight: 900; color: #34c759; text-shadow: 0 0 10px #34c75944; margin: 5px 0; }

    /* LAYOUT */
    main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 30px; position: relative; overflow: hidden; }
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; width: 100%; max-width: 1500px; z-index: 10; }

    /* CARDS */
    .card {
      background: var(--card-glass); border-radius: 40px; padding: 35px 20px;
      text-align: center; position: relative; border: 1px solid rgba(0,0,0,0.05);
      transition: all 0.6s cubic-bezier(0.15, 1, 0.3, 1);
    }
    .card.active { transform: scale(1.08) translateY(-10px); background: #fff; box-shadow: 0 30px 60px rgba(0,0,0,0.1); border-color: transparent; }
    .card.active::before {
      content: ''; position: absolute; inset: -4px; 
      background: var(--rainbow); background-size: 200% 200%;
      border-radius: 44px; z-index: -1;
      animation: rainbowMove 3s linear infinite; filter: blur(10px); opacity: 0.5;
    }

    .session-info { font-size: 13px; font-weight: 800; color: var(--muted); text-transform: uppercase; margin-bottom: 5px; }
    .s-title { font-size: 32px; font-weight: 800; letter-spacing: -1.5px; margin-bottom: 15px; }

    /* REVOLVING COIN */
    .circle-wrap { width: 180px; height: 180px; margin: 0 auto; position: relative; perspective: 1000px; }
    .ring-svg { transform: rotate(-90deg); position: absolute; inset: 0; z-index: 10; width: 100%; height: 100%; }
    .ring-bg { fill: none; stroke: #e5e5ea; stroke-width: 8; }
    .ring-bar { fill: none; stroke: var(--blue); stroke-width: 8; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 0.8s linear; }
    
    .active .ring-bar { stroke: url(#rainbowGrad); }

    .coin {
      width: 140px; height: 140px; position: absolute; top: 20px; left: 20px;
      transform-style: preserve-3d; transition: transform 0.6s; z-index: 5;
    }
    .coin.spinning { animation: spin3d 4s infinite linear; }
    .face { 
        position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
        border-radius: 50%; background: #fff; overflow: hidden;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
        border: 2px solid #fff;
    }
    .face.back { transform: rotateY(180deg); }
    .face img { 
        width: 100%; height: 100%; 
        object-fit: cover; 
        display: block;
    }

    @keyframes spin3d { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

    .time-left { font-size: 50px; font-weight: 900; margin-top: 20px; letter-spacing: -2px; font-variant-numeric: tabular-nums; color: #d1d1d6; }
    .active .time-left { color: var(--text); }

    /* FOOTER */
    footer {
      background: #fff; border-top: 1px solid #e5e5e5; padding: 20px 40px; 
      display: flex; justify-content: space-between; align-items: center; z-index: 100;
    }
    .btn-group { display: flex; gap: 10px; }
    .apple-btn {
      background: var(--text); color: #fff; border: none;
      padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 700;
      cursor: pointer; transition: 0.2s;
    }
    .apple-btn:hover { opacity: 0.8; transform: translateY(-2px); }
    .btn-gray { background: #e8e8ed; color: var(--text); }

    .pill { background: #f2f2f7; padding: 4px; border-radius: 14px; display: flex; gap: 4px; }
    .g-btn {
      border: none; background: transparent; padding: 8px 16px; border-radius: 10px;
      font-size: 12px; font-weight: 750; cursor: pointer; color: var(--muted);
    }
    .g-btn.active { background: #fff; color: var(--text); box-shadow: 0 2px 8px rgba(0,0,0,0.1); }

    /* ANIMATIONS */
    #animation-container { position: absolute; inset: 0; pointer-events: none; z-index: 0; }
    .snowflake { position: absolute; background: #fff; border-radius: 50%; opacity: 0.8; pointer-events: none; animation: fall linear infinite; }
    @keyframes fall { from { transform: translateY(-10vh); } to { transform: translateY(110vh); } }
    
    .firework { position: absolute; width: 6px; height: 6px; border-radius: 50%; animation: explode 1s ease-out forwards; z-index: 5; }
    @keyframes explode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(40); opacity: 0; box-shadow: 0 0 30px 10px currentColor; } }

    .bubble { 
      position: absolute; bottom: -120px; width: 35px; height: 35px; border-radius: 50%; 
      background: rgba(255, 255, 255, 0.4); box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.5); 
      animation: rise 10s infinite ease-in; pointer-events: none; border: 1px solid rgba(255,255,255,0.3);
    }
    @keyframes rise { 0% { transform: translateY(0) translateX(0) scale(0.6); opacity: 0; } 10% { opacity: 0.8; } 100% { transform: translateY(-120vh) translateX(60px) scale(1.2); opacity: 0; } }

    .sparkle { position: absolute; width: 4px; height: 4px; border-radius: 50%; background: radial-gradient(circle, #fff, transparent); opacity: 0; animation: sparkle 2.5s ease-out forwards; pointer-events: none; }
    @keyframes sparkle { 0% { opacity: 1; transform: scale(1) rotate(0deg); } 100% { opacity: 0; transform: scale(5) rotate(180deg); } }

    .penguin { 
      position: absolute; bottom: 80px; width: 60px; height: 75px; 
      background: url("images/tux.png") center/contain no-repeat; 
      animation: waddle 15s linear infinite; pointer-events: none; opacity: 0.9; z-index: 15;
      filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));
    }
    @keyframes waddle { 
      0% { transform: translateX(-15vw) scaleX(1) rotate(0deg); } 
      25% { transform: translateX(45vw) scaleX(1) rotate(5deg); }
      45% { transform: translateX(115vw) scaleX(1) rotate(0deg); } 
      50% { transform: translateX(115vw) scaleX(-1) rotate(0deg); } 
      75% { transform: translateX(45vw) scaleX(-1) rotate(-5deg); }
      100% { transform: translateX(-15vw) scaleX(-1) rotate(0deg); } 
    }

    /* MATRIX EFFECT */
    #matrix-canvas { position: absolute; inset: 0; opacity: 0; transition: opacity 1s; z-index: 1; pointer-events: none; }
    .matrix-active #matrix-canvas { opacity: 0.15; }
    
    @keyframes rainbowMove { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }

    svg defs { height: 0; width: 0; }
  </style>
</head>
<body id="body-main">

  <header>
    <div><span class="head-label">Date:</span><span class="head-val" id="dDisp">--.--.----</span></div>
    <h1>Mr. Oz Tech Zone Elite</h1>
    <div style="text-align: right;"><span class="head-label">Time:</span><span class="head-val" id="tDisp">00:00:00</span></div>
  </header>

  <div id="flight-deck">
    <div class="deck-lbl">Next Session Deploys In</div>
    <div id="slotTime" class="slot-timer">00:00:00</div>
  </div>

  <main id="main-stage">
    <canvas id="matrix-canvas"></canvas>
    <div id="animation-container"></div>
    
    <div class="grid">
      <!-- Card 0: Login -->
      <div class="card" id="card0">
        <div class="session-info">Session 1 â€” 3 Min</div>
        <div class="s-title">Login</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100">
            <defs>
              <linearGradient id="rainbowGrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ff3b30"/><stop offset="50%" stop-color="#007aff"/><stop offset="100%" stop-color="#ff3b30"/>
              </linearGradient>
            </defs>
            <circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring0" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin0">
            <div class="face front"><img src="images/login.png"></div>
            <div class="face back"><img src="images/login.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm0">03:00</div>
      </div>

      <!-- Card 1: Learning -->
      <div class="card" id="card1">
        <div class="session-info">Session 2 â€” 30 Min</div>
        <div class="s-title">Learning</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring1" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin1">
            <div class="face front"><img src="images/learning.png"></div>
            <div class="face back"><img src="images/learning.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm1">30:00</div>
      </div>

      <!-- Card 2: Dynamic (Typing) -->
      <div class="card" id="card2">
        <div class="session-info">Session 3 â€” 10 Min</div>
        <div class="s-title" id="phase3Title">Typing</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring2" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin2">
            <div class="face front"><img id="p3Front" src="images/typing.png"></div>
            <div class="face back"><img id="p3Back" src="images/nitrotype.jpg"></div>
          </div>
        </div>
        <div class="time-left" id="tm2">10:00</div>
      </div>

      <!-- Card 3: Logout -->
      <div class="card" id="card3">
        <div class="session-info">Session 4 â€” 2 Min</div>
        <div class="s-title">Logout</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring3" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin3">
            <div class="face front"><img src="images/logout4.png"></div>
            <div class="face back"><img src="images/logout4.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm3">02:00</div>
      </div>
    </div>
  </main>

  <footer>
    <div class="btn-group" id="footer-btns">
      <button class="apple-btn" onclick="startAll()">PLAY ALL</button>
      <button class="apple-btn btn-gray" id="btn-jump0" onclick="jump(0)">LOGIN</button>
      <button class="apple-btn btn-gray" id="btn-jump1" onclick="jump(1)">LEARN</button>
      <button class="apple-btn btn-gray" id="btn-jump2" onclick="jump(2)">GAME</button>
      <button class="apple-btn btn-gray" id="btn-jump3" onclick="jump(3)">LOGOUT</button>
      <button onclick="playChime()" style="background:none; border:none; font-size:24px; cursor:pointer; margin-left:10px;">ðŸ””</button>
    </div>

    <div style="display: flex; gap: 20px;">
      <div class="pill">
        <button class="g-btn active" id="g-prek" onclick="setGrade('prek')">PreK-2</button>
        <button class="g-btn" id="g-35" onclick="setGrade('35')">Grade 3-5</button>
      </div>
      
      <div class="pill">
        <button class="g-btn active" id="m-real" onclick="setMode('real')">Real</button>
        <button class="g-btn" id="m-sim" onclick="setMode('sim')">Sim</button>
        <button class="g-btn" id="m-flash" onclick="setMode('flash')">Flash</button>
      </div>
    </div>
  </footer>

  <script>
    const mins = [3, 30, 10, 2], names = ["Login", "Learning", "Typing", "Logout"];
    let mode = 'real', anchor = null, activeIdx = -1, audioCtx = null, voices = [];
    const animContainer = document.getElementById('animation-container');
    const mainStage = document.getElementById('main-stage');
    const bodyMain = document.getElementById('body-main');

    // --- VOICE INITIALIZATION ---
    function loadVoices() {
      voices = window.speechSynthesis.getVoices();
    }
    loadVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    function getBestVoice() {
      // Preferred voices: Siri-like or high quality female voices
      const preferred = ["Samantha", "Siri", "Google US English", "Microsoft Zira", "English (United States)"];
      for (let p of preferred) {
        let v = voices.find(v => v.name.includes(p) || v.voiceURI.includes(p));
        if (v) return v;
      }
      // Fallback to any female-sounding voice or first english voice
      return voices.find(v => v.lang.includes("en")) || voices[0];
    }

    // --- MATRIX EFFECT ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx_m = canvas.getContext('2d');
    let characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$+-*/=%\"'#&_(),.;:?!\\|{}<>[]^~";
    characters = characters.split("");
    let fontSize = 14, columns = 0, drops = [];

    function initMatrix() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        columns = canvas.width / fontSize;
        drops = [];
        for (let x = 0; x < columns; x++) drops[x] = 1;
    }
    window.onresize = initMatrix;
    initMatrix();

    function drawMatrix() {
        ctx_m.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx_m.fillRect(0, 0, canvas.width, canvas.height);
        ctx_m.fillStyle = "#0F0";
        ctx_m.font = fontSize + "px arial";
        for (let i = 0; i < drops.length; i++) {
            const text = characters[Math.floor(Math.random() * characters.length)];
            ctx_m.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }
    setInterval(drawMatrix, 35);

    // --- ANIMATION MANAGER ---
    let currentAnimTheme = 0; // 0: Default, 1: Matrix, 2: Colorful, 3: Bubble Burst
    function rotateTheme() {
        currentAnimTheme = (currentAnimTheme + 1) % 4;
        mainStage.classList.remove('matrix-active');
        bodyMain.style.backgroundColor = "";
        
        if (currentAnimTheme === 1) {
            mainStage.classList.add('matrix-active');
        } else if (currentAnimTheme === 2) {
            const colors = ["#f5f5f7", "#e3f2fd", "#f1f8e9", "#fff3e0", "#fce4ec", "#f3e5f5"];
            bodyMain.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        }
    }
    setInterval(rotateTheme, 5000);

    // --- ANIMATIONS ---
    function createSnow() {
      for(let i=0; i<30; i++) {
        const s = document.createElement('div');
        s.className = 'snowflake';
        const size = Math.random() * 8 + 4;
        s.style.width = s.style.height = size + 'px';
        s.style.left = Math.random() * 100 + 'vw';
        s.style.animationDuration = Math.random() * 3 + 4 + 's';
        s.style.animationDelay = Math.random() * 5 + 's';
        animContainer.appendChild(s);
      }
    }

    function createFirework() {
      const count = 5;
      for(let i=0; i<count; i++) {
        setTimeout(() => {
          const f = document.createElement('div');
          f.className = 'firework';
          f.style.left = Math.random() * 80 + 10 + 'vw';
          f.style.top = Math.random() * 60 + 20 + 'vh';
          f.style.color = `hsl(${Math.random()*360}, 100%, 50%)`;
          animContainer.appendChild(f);
          setTimeout(() => f.remove(), 1000);
        }, i * 300);
      }
    }

    function createBubbles(count = 12) {
      for (let i = 0; i < count; i++) {
        const b = document.createElement('div');
        b.className = 'bubble';
        const size = Math.random() * 30 + 15;
        b.style.width = b.style.height = size + 'px';
        b.style.left = Math.random() * 100 + 'vw';
        b.style.animationDuration = (7 + Math.random() * 7) + 's';
        b.style.animationDelay = (Math.random() * 5) + 's';
        animContainer.appendChild(b);
      }
    }

    function createSparkles() {
      for (let i = 0; i < 10; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = (Math.random() * 100) + 'vw';
        s.style.top = (Math.random() * 100) + 'vh';
        animContainer.appendChild(s);
        setTimeout(() => s.remove(), 2500);
      }
    }

    function createPenguins(count = 2) {
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'penguin';
        p.style.left = (-15 - i * 10) + 'vw';
        p.style.bottom = (70 + i * 25) + 'px';
        p.style.animationDelay = (i * 3) + 's';
        animContainer.appendChild(p);
      }
    }

    createSnow();
    createBubbles();
    createPenguins(3);

    // --- LOGIC ---
    function setGrade(val) {
      document.getElementById('g-prek').classList.remove('active');
      document.getElementById('g-35').classList.remove('active');
      document.getElementById('g-'+val).classList.add('active');

      const title = document.getElementById('phase3Title'),
            front = document.getElementById('p3Front'),
            back = document.getElementById('p3Back');
            
      const b0 = document.getElementById('btn-jump0'),
            b1 = document.getElementById('btn-jump1'),
            b2 = document.getElementById('btn-jump2'),
            b3 = document.getElementById('btn-jump3');

      if(val === 'prek') {
        title.innerText = "ABC / PBS";
        front.src = "images/abc.jpg"; back.src = "images/pbs.png";
        b0.innerText = "LOGIN"; b1.innerText = "LEARN"; b2.innerText = "GAMING"; b3.innerText = "LOGOUT";
      } else {
        title.innerText = "Typing / Nitro";
        front.src = "images/typing.png"; back.src = "images/nitrotype.jpg";
        b0.innerText = "LOGIN"; b1.innerText = "LEARN"; b2.innerText = "TYPING"; b3.innerText = "LOGOUT";
      }
    }
    setGrade('prek');

    function getAudio() {
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === 'suspended') audioCtx.resume();
      return audioCtx;
    }

    function playChime() {
      const ctx = getAudio(); const now = ctx.currentTime;
      [554, 440, 329, 277].forEach((f, i) => {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.frequency.setValueAtTime(f, now + i * 0.45);
        g.gain.setValueAtTime(0, now + i * 0.45);
        g.gain.linearRampToValueAtTime(0.2, now + i * 0.45 + 0.05);
        g.gain.exponentialRampToValueAtTime(0.01, now + (i + 1.2) * 0.85);
        o.connect(g); g.connect(ctx.destination);
        o.start(now + i * 0.45); o.stop(now + (i + 1.2) * 0.85);
      });
    }

    async function announce(idx) {
      playChime(); createFirework();
      await new Promise(r => setTimeout(r, 2200));
      
      let msg = "";
      const isPreK = document.getElementById('g-prek').classList.contains('active');

      if (idx === 0) {
        msg = "Please login to your accounts.";
      } else if (idx === 1) {
        msg = "Dear students you can start working on learning.com right now. this session is going to take 30 min. Please do not remove any equipment, mouse, keyboard, headphones, from the desktop computers. If you need anything please ask your teacher for assistance.";
      } else if (idx === 2) {
        msg = isPreK ? "It is educational game time." : "Typing session started. you can start working on typing.com or nitrotype.com now.";
      } else if (idx === 3) {
        msg = "Dear Students. The class is over now, please log out from your accounts, close your chromebooks, organize your desk,.. Please Stand up Push your chairs And stand up right next to your chair. Please wait until your teacher dismiss you. Have a wonderful day";
      } else {
        msg = names[idx] + " session is active."; // Fallback
      }

      const utterance = new SpeechSynthesisUtterance(msg);
      utterance.voice = getBestVoice();
      utterance.rate = 0.9; // Slightly slower for clarity
      utterance.pitch = 1.0;
      window.speechSynthesis.speak(utterance);
    }

    function setMode(m) {
      mode = m; anchor = null; activeIdx = -1;
      document.querySelectorAll('.g-btn').forEach(b => {
        if (b.id.startsWith('m-')) b.classList.remove('active');
      });
      document.getElementById('m-'+m).classList.add('active');
    }

    function startAll() {
      if(mode === 'real') setMode('sim');
      const d = new Date(); d.setHours(7, 50, 0, 0);
      anchor = { real: Date.now(), fake: d.getTime() };
      activeIdx = -1;
    }

    function jump(idx) {
      if(mode === 'real') setMode('sim');
      const d = new Date();
      let off = 0; for(let i=0; i<idx; i++) off += mins[i];
      anchor = { real: Date.now(), fake: d.setHours(7, 50 + off, 0, 0) };
      activeIdx = -1;
    }

    function tick() {
      const real = new Date();
      
      const month = String(real.getMonth() + 1).padStart(2, '0');
      const day = String(real.getDate()).padStart(2, '0');
      const year = real.getFullYear();
      document.getElementById('dDisp').textContent = `${month}.${day}.${year}`;
      
      document.getElementById('tDisp').textContent = real.toLocaleTimeString('tr-TR', {hour12:false});

      const startS = 7*3600 + 50*60, endS = startS + (45*60);
      const currSecs = real.getHours()*3600 + real.getMinutes()*60 + real.getSeconds();
      const inSession = currSecs >= startS && currSecs < endS;
      const standby = mode === 'real' && !inSession;
      
      document.getElementById('flight-deck').classList.toggle('active', standby);

      let now = (mode === 'real')
        ? real
        : (anchor ? new Date(anchor.fake + (Date.now() - anchor.real) * (mode === 'flash' ? 60 : 1)) : null);

      let anyActive = false;

      if(now) {
        const total = now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds();
        let acc = startS;
        for(let i=0; i<4; i++) {
          const c = document.getElementById(`card${i}`),
                r = document.getElementById(`ring${i}`),
                t = document.getElementById(`tm${i}`),
                coin = document.getElementById(`coin${i}`);
          const dur = mins[i]*60;
          if(total >= acc && total < acc + dur) {
            anyActive = true;
            if(i !== activeIdx) { announce(i); activeIdx = i; }
            c.classList.add('active'); coin.classList.add('spinning');
            const rem = Math.ceil(acc + dur - total);
            t.textContent = new Date(rem * 1000).toISOString().substr(14, 5);
            r.style.strokeDashoffset = 283 - ((total - acc) / dur * 283);
          } else {
            c.classList.remove('active'); coin.classList.remove('spinning');
            r.style.strokeDashoffset = (total >= acc+dur) ? 0 : 283;
            t.textContent = (total >= acc+dur) ? "DONE" : `${mins[i].toString().padStart(2,'0')}:00`;
          }
          acc += dur;
        }
      }

      // STANDBY / WAITING TIME ANIMATIONS
      if (standby) {
          if (Math.random() < 0.2) createFirework();
          if (Math.random() < 0.15) createSparkles();
          if (Math.random() < 0.1) createBubbles(2);
      }

      if (!standby && now && !anyActive) {
        if (Math.random() < 0.05) createFirework();
        if (Math.random() < 0.08) createSparkles();
      }

      if(standby) {
        let target = new Date(real); target.setHours(7,50,0,0);
        if(currSecs >= endS) target.setDate(target.getDate()+1);
        while(target.getDay()===0 || target.getDay()===6) target.setDate(target.getDate()+1);
        const diff = Math.floor((target - real) / 1000);
        const h = Math.floor(diff/3600), m = Math.floor((diff%3600)/60), s = diff%60;
        document.getElementById('slotTime').textContent =
          `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
      }
    }
    setInterval(tick, 1000); tick();
  </script>
</body>
</html>
