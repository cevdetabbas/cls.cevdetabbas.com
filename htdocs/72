<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>v2 gen5 | v72</title>
  <style>
    :root {
      --bg: #0f172a;
      --card-glass: rgba(255, 255, 255, 0.08);
      --card-border: rgba(255, 255, 255, 0.12);
      --accent: #38bdf8;
      --text: #f8fafc;
      --muted: #94a3b8;
      --blue: #0ea5e9;
      --rainbow: linear-gradient(120deg, #38bdf8, #818cf8, #c084fc, #f472b6, #fb7185, #fb923c, #fbbf24);
    }

    * { box-sizing: border-box; -webkit-font-smoothing: antialiased; margin: 0; padding: 0; }
    
    body {
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* CRYSTAL AURA BACKGROUND */
    #aura-bg {
      position: fixed;
      inset: 0;
      z-index: -2;
      background: radial-gradient(circle at 20% 20%, #1e1b4b 0%, transparent 40%),
                  radial-gradient(circle at 80% 80%, #1e293b 0%, transparent 40%),
                  radial-gradient(circle at 50% 50%, #0f172a 0%, #020617 100%);
      animation: auraShift 20s infinite alternate ease-in-out;
    }
    @keyframes auraShift {
      0% { filter: hue-rotate(0deg); }
      100% { filter: hue-rotate(30deg); }
    }

    /* FLOATING PARTICLES */
    #particle-container {
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
    }
    .particle {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.3;
      filter: blur(1px);
      animation: floatParticle var(--d) linear infinite;
    }
    @keyframes floatParticle {
      from { transform: translateY(110vh) scale(0); opacity: 0; }
      20% { opacity: 0.4; }
      80% { opacity: 0.4; }
      to { transform: translateY(-10vh) scale(1); opacity: 0; }
    }

    /* HEADER */
    header {
      background: rgba(15, 23, 42, 0.6);
      padding: 20px 60px;
      display: grid;
      grid-template-columns: 240px 1fr 240px;
      align-items: center;
      border-bottom: 1px solid var(--card-border);
      z-index: 100;
      backdrop-filter: blur(15px);
    }
    .head-label { font-size: 10px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 4px; display: block; }
    .head-val { font-variant-numeric: tabular-nums; font-weight: 600; font-size: 20px; color: var(--accent); }
    h1 { text-align: center; margin: 0; font-size: 28px; font-weight: 900; letter-spacing: -1.5px; background: linear-gradient(to bottom, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    /* FLIGHT DECK */
    #flight-deck {
      background: rgba(2, 6, 23, 0.8);
      color: #fff;
      height: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: height 0.6s cubic-bezier(0.16, 1, 0.3, 1);
      z-index: 90;
      border-bottom: 1px solid var(--card-border);
    }
    #flight-deck.active { height: 120px; }
    .deck-lbl { font-size: 10px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 3px; }
    .slot-timer { font-family: 'SF Mono', 'Courier New', monospace; font-size: 48px; font-weight: 900; color: #10b981; text-shadow: 0 0 20px rgba(16, 185, 129, 0.4); margin: 5px 0; }

    /* MAIN STAGE */
    main { flex: 1; display: flex; align-items: center; justify-content: center; padding: 40px; position: relative; }
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 30px; width: 100%; max-width: 1600px; z-index: 10; }

    /* ELEGANT CARDS */
    .card {
      background: var(--card-glass);
      border-radius: 40px;
      padding: 40px 24px;
      text-align: center;
      position: relative;
      border: 1px solid var(--card-border);
      backdrop-filter: blur(20px);
      transition: all 0.7s cubic-bezier(0.15, 1, 0.3, 1);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    .card.active {
      transform: scale(1.06) translateY(-15px);
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 40px 80px rgba(0,0,0,0.4);
    }
    .card.active::before {
      content: ''; position: absolute; inset: -2px;
      background: var(--rainbow);
      border-radius: 42px; z-index: -1;
      animation: auraGlow 4s linear infinite; filter: blur(15px); opacity: 0.6;
    }
    @keyframes auraGlow {
      0% { opacity: 0.4; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.02); }
      100% { opacity: 0.4; transform: scale(1); }
    }

    .session-info { font-size: 11px; font-weight: 800; color: var(--muted); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 8px; }
    .s-title { font-size: 34px; font-weight: 800; letter-spacing: -1px; margin-bottom: 20px; }

    /* REVOLVING COIN */
    .circle-wrap { width: 190px; height: 190px; margin: 0 auto; position: relative; perspective: 1200px; }
    .ring-svg { transform: rotate(-90deg); position: absolute; inset: 0; z-index: 10; width: 100%; height: 100%; }
    .ring-bg { fill: none; stroke: rgba(255,255,255,0.05); stroke-width: 6; }
    .ring-bar { fill: none; stroke: var(--blue); stroke-width: 6; stroke-linecap: round; stroke-dasharray: 283; stroke-dashoffset: 283; transition: stroke-dashoffset 0.8s linear; }
    
    .active .ring-bar { stroke: url(#auraGrad); filter: drop-shadow(0 0 5px var(--accent)); }

    .coin {
      width: 140px; height: 140px; position: absolute; top: 25px; left: 25px;
      transform-style: preserve-3d; transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 5;
    }
    .coin.spinning { animation: spin3d 5s infinite linear; }
    .face { 
        position: absolute; width: 100%; height: 100%; backface-visibility: hidden; 
        border-radius: 50%; background: #fff; overflow: hidden;
        box-shadow: 0 0 20px rgba(0,0,0,0.3);
        border: 3px solid rgba(255,255,255,0.8);
    }
    .face.back { transform: rotateY(180deg); }
    .face img { width: 100%; height: 100%; object-fit: cover; display: block; }

    @keyframes spin3d { from { transform: rotateY(0deg); } to { transform: rotateY(360deg); } }

    .time-left { font-size: 54px; font-weight: 900; margin-top: 25px; letter-spacing: -3px; font-variant-numeric: tabular-nums; color: var(--muted); transition: color 0.5s; }
    .active .time-left { color: #fff; text-shadow: 0 0 20px rgba(255,255,255,0.3); }

    /* FOOTER */
    footer {
      background: rgba(15, 23, 42, 0.8);
      border-top: 1px solid var(--card-border);
      padding: 25px 60px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 100;
      backdrop-filter: blur(20px);
    }
    .btn-group { display: flex; gap: 15px; }
    .crystal-btn {
      background: rgba(255, 255, 255, 0.05);
      color: #fff;
      border: 1px solid var(--card-border);
      padding: 14px 28px;
      border-radius: 16px;
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
    }
    .crystal-btn:hover { background: #fff; color: #000; transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    .btn-primary { background: var(--blue); border-color: transparent; }
    .btn-primary:hover { background: #38bdf8; color: #fff; }

    .pill { background: rgba(255,255,255,0.05); padding: 5px; border-radius: 18px; display: flex; gap: 5px; border: 1px solid var(--card-border); }
    .p-btn {
      border: none; background: transparent; padding: 10px 20px; border-radius: 14px;
      font-size: 11px; font-weight: 800; cursor: pointer; color: var(--muted);
      transition: all 0.3s; text-transform: uppercase; letter-spacing: 1px;
    }
    .p-btn.active { background: #fff; color: #0f172a; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }

    /* ANIMATIONS */
    #animation-container { position: absolute; inset: 0; pointer-events: none; z-index: 0; }
    
    .firework { position: absolute; width: 8px; height: 8px; border-radius: 50%; animation: crystalExplode 1.2s ease-out forwards; z-index: 5; }
    @keyframes crystalExplode { 0% { transform: scale(1); opacity: 1; } 100% { transform: scale(50); opacity: 0; box-shadow: 0 0 40px 10px currentColor; } }

    .bubble { 
      position: absolute; bottom: -120px; border-radius: 50%; 
      background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255,255,255,0.2);
      backdrop-filter: blur(2px);
      animation: rise 12s infinite ease-in; pointer-events: none;
    }
    @keyframes rise { 0% { transform: translateY(0) translateX(0) scale(0.5); opacity: 0; } 10% { opacity: 0.6; } 100% { transform: translateY(-120vh) translateX(80px) scale(1.5); opacity: 0; } }

    .sparkle { position: absolute; width: 5px; height: 5px; border-radius: 50%; background: #fff; opacity: 0; animation: crystalSparkle 3s ease-out forwards; pointer-events: none; }
    @keyframes crystalSparkle { 0% { opacity: 0.8; transform: scale(0) rotate(0deg); } 50% { opacity: 1; transform: scale(1.5) rotate(90deg); } 100% { opacity: 0; transform: scale(0) rotate(180deg); } }

    .penguin { 
      position: absolute; bottom: 90px; width: 65px; height: 80px; 
      background: url("images/tux.png") center/contain no-repeat; 
      animation: waddle 18s linear infinite; pointer-events: none; opacity: 0.85; z-index: 15;
      filter: drop-shadow(0 10px 15px rgba(0,0,0,0.4));
    }
    @keyframes waddle { 
      0% { transform: translateX(-20vw) scaleX(1) rotate(0deg); } 
      25% { transform: translateX(40vw) scaleX(1) rotate(6deg); }
      45% { transform: translateX(120vw) scaleX(1) rotate(0deg); } 
      50% { transform: translateX(120vw) scaleX(-1) rotate(0deg); } 
      75% { transform: translateX(40vw) scaleX(-1) rotate(-6deg); }
      100% { transform: translateX(-20vw) scaleX(-1) rotate(0deg); } 
    }

    /* MATRIX OVERLAY */
    #matrix-canvas { position: absolute; inset: 0; opacity: 0; transition: opacity 1.5s; z-index: 1; pointer-events: none; }
    .matrix-active #matrix-canvas { opacity: 0.12; }
    
    svg defs { height: 0; width: 0; }
  </style>
</head>
<body id="body-main">

  <div id="aura-bg"></div>
  <div id="particle-container"></div>

  <header>
    <div><span class="head-label">Current Date</span><span class="head-val" id="dDisp">--.--.----</span></div>
    <h1>TECH ZONE CRYSTAL</h1>
    <div style="text-align: right;"><span class="head-label">System Time</span><span class="head-val" id="tDisp">00:00:00</span></div>
  </header>

  <div id="flight-deck">
    <div class="deck-lbl">Mission Deployment In</div>
    <div id="slotTime" class="slot-timer">00:00:00</div>
  </div>

  <main id="main-stage">
    <canvas id="matrix-canvas"></canvas>
    <div id="animation-container"></div>
    
    <div class="grid">
      <!-- Card 0: Login -->
      <div class="card" id="card0">
        <div class="session-info">PHASE 01 â€” 3 MIN</div>
        <div class="s-title">Login</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100">
            <defs>
              <linearGradient id="auraGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#38bdf8"/><stop offset="50%" stop-color="#c084fc"/><stop offset="100%" stop-color="#38bdf8"/>
              </linearGradient>
            </defs>
            <circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring0" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin0">
            <div class="face front"><img src="images/login.png"></div>
            <div class="face back"><img src="images/login.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm0">03:00</div>
      </div>

      <!-- Card 1: Learning -->
      <div class="card" id="card1">
        <div class="session-info">PHASE 02 â€” 30 MIN</div>
        <div class="s-title">Learning</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring1" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin1">
            <div class="face front"><img src="images/learning.png"></div>
            <div class="face back"><img src="images/learning.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm1">30:00</div>
      </div>

      <!-- Card 2: Dynamic -->
      <div class="card" id="card2">
        <div class="session-info">PHASE 03 â€” 10 MIN</div>
        <div class="s-title" id="phase3Title">Typing</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring2" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin2">
            <div class="face front"><img id="p3Front" src="images/typing.png"></div>
            <div class="face back"><img id="p3Back" src="images/nitrotype.jpg"></div>
          </div>
        </div>
        <div class="time-left" id="tm2">10:00</div>
      </div>

      <!-- Card 3: Logout -->
      <div class="card" id="card3">
        <div class="session-info">PHASE 04 â€” 2 MIN</div>
        <div class="s-title">Logout</div>
        <div class="circle-wrap">
          <svg class="ring-svg" viewBox="0 0 100 100"><circle class="ring-bg" cx="50" cy="50" r="45"/><circle class="ring-bar" id="ring3" cx="50" cy="50" r="45"/></svg>
          <div class="coin" id="coin3">
            <div class="face front"><img src="images/logout4.png"></div>
            <div class="face back"><img src="images/logout4.png"></div>
          </div>
        </div>
        <div class="time-left" id="tm3">02:00</div>
      </div>
    </div>
  </main>

  <footer>
    <div class="btn-group" id="footer-btns">
      <button class="crystal-btn btn-primary" onclick="startAll()">Initiate All</button>
      <button class="crystal-btn" id="btn-jump0" onclick="jump(0)">Login</button>
      <button class="crystal-btn" id="btn-jump1" onclick="jump(1)">Learn</button>
      <button class="crystal-btn" id="btn-jump2" onclick="jump(2)">Game</button>
      <button class="crystal-btn" id="btn-jump3" onclick="jump(3)">Logout</button>
      <button onclick="playChime()" style="background:none; border:none; font-size:32px; cursor:pointer; margin-left:15px; filter: drop-shadow(0 0 10px var(--accent));">ðŸ””</button>
    </div>

    <div style="display: flex; gap: 25px;">
      <div class="pill">
        <button class="p-btn active" id="g-prek" onclick="setGrade('prek')">PreK-2</button>
        <button class="p-btn" id="g-35" onclick="setGrade('35')">Grade 3-5</button>
      </div>
      
      <div class="pill">
        <button class="p-btn active" id="m-real" onclick="setMode('real')">Real</button>
        <button class="p-btn" id="m-sim" onclick="setMode('sim')">Sim</button>
        <button class="p-btn" id="m-flash" onclick="setMode('flash')">Flash</button>
      </div>
    </div>
  </footer>

  <script>
    const mins = [3, 30, 10, 2], names = ["Login", "Learning", "Typing", "Logout"];
    let mode = 'real', anchor = null, activeIdx = -1, audioCtx = null, voices = [];
    const animContainer = document.getElementById('animation-container');
    const mainStage = document.getElementById('main-stage');
    const bodyMain = document.getElementById('body-main');

    // --- PARTICLE SYSTEM ---
    function initParticles() {
      const container = document.getElementById('particle-container');
      for(let i=0; i<40; i++) {
        const p = document.createElement('div');
        p.className = 'particle';
        const size = Math.random() * 4 + 1;
        p.style.width = size + 'px';
        p.style.height = size + 'px';
        p.style.left = Math.random() * 100 + 'vw';
        p.style.setProperty('--d', (Math.random() * 10 + 5) + 's');
        p.style.animationDelay = (Math.random() * 10) + 's';
        container.appendChild(p);
      }
    }
    initParticles();

    // --- VOICE INITIALIZATION ---
    function loadVoices() {
      voices = window.speechSynthesis.getVoices();
    }
    loadVoices();
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }

    function getBestVoice() {
      const preferred = ["Samantha", "Siri", "Google US English", "Microsoft Zira", "English (United States)"];
      for (let p of preferred) {
        let v = voices.find(v => v.name.includes(p) || v.voiceURI.includes(p));
        if (v) return v;
      }
      return voices.find(v => v.lang.includes("en")) || voices[0];
    }

    // --- MATRIX EFFECT ---
    const canvas = document.getElementById('matrix-canvas');
    const ctx_m = canvas.getContext('2d');
    let characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789$+-*/=%\"'#&_(),.;:?!\\|{}<>[]^~";
    characters = characters.split("");
    let fontSize = 14, columns = 0, drops = [];

    function initMatrix() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        columns = canvas.width / fontSize;
        drops = [];
        for (let x = 0; x < columns; x++) drops[x] = 1;
    }
    window.onresize = initMatrix;
    initMatrix();

    function drawMatrix() {
        ctx_m.fillStyle = "rgba(15, 23, 42, 0.05)";
        ctx_m.fillRect(0, 0, canvas.width, canvas.height);
        ctx_m.fillStyle = "#0ea5e9";
        ctx_m.font = fontSize + "px arial";
        for (let i = 0; i < drops.length; i++) {
            const text = characters[Math.floor(Math.random() * characters.length)];
            ctx_m.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }
    setInterval(drawMatrix, 35);

    // --- THEME CYCLER ---
    let currentThemeIdx = 0;
    function cycleTheme() {
        currentThemeIdx = (currentThemeIdx + 1) % 4;
        mainStage.classList.remove('matrix-active');
        if (currentThemeIdx === 1) {
            mainStage.classList.add('matrix-active');
        }
    }
    setInterval(cycleTheme, 10000);

    // --- ANIMATIONS ---
    function createFirework() {
      for(let i=0; i<4; i++) {
        setTimeout(() => {
          const f = document.createElement('div');
          f.className = 'firework';
          f.style.left = Math.random() * 90 + 5 + 'vw';
          f.style.top = Math.random() * 70 + 15 + 'vh';
          f.style.color = `hsl(${Math.random()*360}, 80%, 70%)`;
          animContainer.appendChild(f);
          setTimeout(() => f.remove(), 1200);
        }, i * 250);
      }
    }

    function createBubbles(count = 8) {
      for (let i = 0; i < count; i++) {
        const b = document.createElement('div');
        b.className = 'bubble';
        const size = Math.random() * 35 + 15;
        b.style.width = b.style.height = size + 'px';
        b.style.left = Math.random() * 100 + 'vw';
        b.style.animationDuration = (8 + Math.random() * 10) + 's';
        animContainer.appendChild(b);
        setTimeout(() => b.remove(), 15000);
      }
    }

    function createSparkles() {
      for (let i = 0; i < 8; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = (Math.random() * 100) + 'vw';
        s.style.top = (Math.random() * 100) + 'vh';
        animContainer.appendChild(s);
        setTimeout(() => s.remove(), 3000);
      }
    }

    function createPenguins(count = 3) {
      for (let i = 0; i < count; i++) {
        const p = document.createElement('div');
        p.className = 'penguin';
        p.style.left = (-20 - i * 12) + 'vw';
        p.style.bottom = (80 + i * 30) + 'px';
        p.style.animationDelay = (i * 4) + 's';
        animContainer.appendChild(p);
      }
    }
    createPenguins();

    // --- LOGIC ---
    function setGrade(val) {
      document.getElementById('g-prek').classList.remove('active');
      document.getElementById('g-35').classList.remove('active');
      document.getElementById('g-'+val).classList.add('active');

      const title = document.getElementById('phase3Title'),
            front = document.getElementById('p3Front'),
            back = document.getElementById('p3Back');
      const b0 = document.getElementById('btn-jump0'),
            b1 = document.getElementById('btn-jump1'),
            b2 = document.getElementById('btn-jump2'),
            b3 = document.getElementById('btn-jump3');

      if(val === 'prek') {
        title.innerText = "ABC / PBS";
        front.src = "images/abc.jpg"; back.src = "images/pbs.png";
        b0.innerText = "Login"; b1.innerText = "Learn"; b2.innerText = "Gaming"; b3.innerText = "Logout";
      } else {
        title.innerText = "Typing / Nitro";
        front.src = "images/typing.png"; back.src = "images/nitrotype.jpg";
        b0.innerText = "Login"; b1.innerText = "Learn"; b2.innerText = "Typing"; b3.innerText = "Logout";
      }
    }
    setGrade('prek');

    function getAudio() {
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if(audioCtx.state === 'suspended') audioCtx.resume();
      return audioCtx;
    }

    function playChime() {
      const ctx = getAudio();
      const now = ctx.currentTime + 0.1; 
      [554, 440, 329, 277].forEach((f, i) => {
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.frequency.setValueAtTime(f, now + i * 0.45);
        g.gain.setValueAtTime(0, now + i * 0.45);
        g.gain.linearRampToValueAtTime(0.2, now + i * 0.45 + 0.05);
        g.gain.exponentialRampToValueAtTime(0.01, now + (i + 1.2) * 0.85);
        o.connect(g); g.connect(ctx.destination);
        o.start(now + i * 0.45); o.stop(now + (i + 1.2) * 0.85);
      });
    }

    async function announce(idx) {
      await new Promise(r => setTimeout(r, 100));
      playChime(); createFirework();
      await new Promise(r => setTimeout(r, 2300));
      
      let msg = "";
      const isPreK = document.getElementById('g-prek').classList.contains('active');
      if (idx === 0) msg = "Please login to your accounts.";
      else if (idx === 1) msg = "Dear students you can start working on learning.com right now. this session is going to take 30 min. Please do not remove any equipment, mouse, keyboard, headphones, from the desktop computers. If you need anything please ask your teacher for assistance.";
      else if (idx === 2) msg = isPreK ? "It is educational game time." : "Typing session started. you can start working on typing.com or nitrotype.com now.";
      else if (idx === 3) msg = "Dear Students. The class is over now, please log out from your accounts, close your chromebooks, organize your desk,.. Please Stand up Push your chairs And stand up right next to your chair. Please wait until your teacher dismiss you. Have a wonderful day";
      
      const utterance = new SpeechSynthesisUtterance(msg);
      utterance.voice = getBestVoice();
      utterance.rate = 0.9;
      window.speechSynthesis.speak(utterance);
    }

    function setMode(m) {
      mode = m; anchor = null; activeIdx = -1;
      document.querySelectorAll('.p-btn').forEach(b => {
        if (b.id.startsWith('m-')) b.classList.remove('active');
      });
      document.getElementById('m-'+m).classList.add('active');
    }

    function startAll() {
      if(mode === 'real') setMode('sim');
      const d = new Date(); d.setHours(7, 50, 0, 0);
      anchor = { real: Date.now(), fake: d.getTime() };
      activeIdx = -1;
    }

    function jump(idx) {
      if(mode === 'real') setMode('sim');
      const d = new Date();
      let off = 0; for(let i=0; i<idx; i++) off += mins[i];
      anchor = { real: Date.now(), fake: d.setHours(7, 50 + off, 0, 0) };
      activeIdx = -1;
    }

    function tick() {
      const real = new Date();
      const month = String(real.getMonth() + 1).padStart(2, '0');
      const day = String(real.getDate()).padStart(2, '0');
      document.getElementById('dDisp').textContent = `${month}.${day}.${real.getFullYear()}`;
      document.getElementById('tDisp').textContent = real.toLocaleTimeString('tr-TR', {hour12:false});

      const startS = 7*3600 + 50*60, endS = startS + (45*60);
      const currSecs = real.getHours()*3600 + real.getMinutes()*60 + real.getSeconds();
      const standby = mode === 'real' && (currSecs < startS || currSecs >= endS);
      
      document.getElementById('flight-deck').classList.toggle('active', standby);

      let now = (mode === 'real') ? real : (anchor ? new Date(anchor.fake + (Date.now() - anchor.real) * (mode === 'flash' ? 60 : 1)) : null);

      if(now) {
        const total = now.getHours()*3600 + now.getMinutes()*60 + now.getSeconds();
        let acc = startS;
        for(let i=0; i<4; i++) {
          const c = document.getElementById(`card${i}`), r = document.getElementById(`ring${i}`), t = document.getElementById(`tm${i}`), coin = document.getElementById(`coin${i}`);
          const dur = mins[i]*60;
          if(total >= acc && total < acc + dur) {
            if(i !== activeIdx) { announce(i); activeIdx = i; }
            c.classList.add('active'); coin.classList.add('spinning');
            const rem = Math.ceil(acc + dur - total);
            t.textContent = new Date(rem * 1000).toISOString().substr(14, 5);
            r.style.strokeDashoffset = 283 - ((total - acc) / dur * 283);
          } else {
            c.classList.remove('active'); coin.classList.remove('spinning');
            r.style.strokeDashoffset = (total >= acc+dur) ? 0 : 283;
            t.textContent = (total >= acc+dur) ? "DONE" : `${mins[i].toString().padStart(2,'0')}:00`;
          }
          acc += dur;
        }
      }

      if (standby) {
          if (Math.random() < 0.1) createFirework();
          if (Math.random() < 0.1) createSparkles();
          if (Math.random() < 0.05) createBubbles(1);
      }
    }
    setInterval(tick, 1000); tick();
  </script>
</body>
</html>
